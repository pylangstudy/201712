# [18.3. select — I/O 処理の完了を待機する](https://docs.python.jp/3/library/select.html)

< [18. プロセス間通信とネットワーク](https://docs.python.jp/3/library/ipc.html) < [Python 標準ライブラリ](https://docs.python.jp/3/library/index.html#the-python-standard-library) < [ドキュメント](https://docs.python.jp/3/index.html)

> このモジュールでは、ほとんどのオペレーティングシステムで利用可能な select() および poll() 関数、Solaris やその派生で利用可能な devpoll() 、Linux 2.5+ で利用可能な epoll() 、多くのBSDで利用可能な kqueue() 関数に対するアクセスを提供しています。 Windows 上ではソケットに対してしか動作しないので注意してください; その他のオペレーティングシステムでは、他のファイル形式でも (特に Unixではパイプにも) 動作します。通常のファイルに対して適用し、最後にファイルを読み出した時から内容が増えているかを決定するために使うことはできません。

### 注釈

[selectors](https://docs.python.jp/3/library/selectors.html#module-selectors) モジュールにより、select モジュールプリミティブに基づく高水準かつ効率的な I/O の多重化が行うことが出来ます。 OS レベルプリミティブを使用した正確な制御を求めない限り、このモジュールの使用が推奨されます。

> このモジュールは以下を定義します:

属性|概要
----|----
exception select.error|OSError の非推奨のエイリアスです。
select.devpoll()|(Solaris およびその派生でのみサポートされています) /dev/poll ポーリングオブジェクトを返します。 ポーリングオブジェクトが提供しているメソッドについては ポーリングオブジェクト 節を参照してください。
select.epoll(sizehint=-1, flags=0)|(Linux 2.5.44 以降でのみサポート) エッジポーリング (edge polling) オブジェクトを返します。 このオブジェクトは、 I/O イベントのエッジトリガもしくはレベルトリガインタフェースとして使えます。 sizehint および flags は非推奨であり、無視されます。
select.poll()|(全てのオペレーティングシステムでサポートされているわけではありません) ポーリングオブジェクトを返します。このオブジェクトはファイル記述子を登録したり登録解除したりすることができ、ファイル記述子に対する I/O イベント発生をポーリングすることができます; ポーリングオブジェクトが提供しているメソッドについては ポーリングオブジェクト 節を参照してください。
select.kqueue()|(BSD でのみサポート) カーネルキュー(kernel queue)オブジェクトを返します。カーネルキューオブジェクトが提供しているメソッドについては、 kqueue オブジェクト 節を参照してください。
select.kevent(ident, filter=KQ_FILTER_READ, flags=KQ_EV_ADD, fflags=0, data=0, udata=0)|(BSD でのみサポート) カーネルイベント(kernel event)オブジェクトを返します。カーネルイベントオブジェクトが提供しているメソッドについては、 kevent オブジェクト 節を参照してください。
select.select(rlist, wlist, xlist[, timeout])|Unix の select() システムコールに対する直接的なインタフェースです。最初の 3 つの引数は '待機可能オブジェクト' からなるシーケンスです: 待機可能オブジェクトとは、ファイル記述子を表す整数値か、そのような整数を返す引数なしメソッド fileno() を持つオブジェクトです。
select.PIPE_BUF|select(), poll() またはこのモジュールの別のインタフェースによってパイプが書き込む準備ができていると報告された時に、ブロックせずにパイプに書き込むことのできる最小のバイト数。これはソケットなどの他の種類の file-like オブジェクトには適用されません。

## [18.3.1. /dev/poll ポーリングオブジェクト]()

> Solaris とその派生は、/dev/poll を持っています。 select() が O(最大のファイル記述子) 、 poll() が O(ファイル記述子の数) である一方、 /dev/poll は O(アクティブなファイル記述子) です。

> /dev/poll の挙動は標準的な poll() オブジェクトに非常に近いです。

属性|概要
----|----
devpoll.close()|ポーリングオブジェクトのファイル記述子を閉じます。
devpoll.closed|ポーリングオブジェクトが閉じている場合 True です。
devpoll.fileno()|ポーリングオブジェクトのファイル記述子番号を返します。
devpoll.register(fd[, eventmask])|ファイル記述子をポーリングオブジェクトに登録します。これ以降の poll() メソッド呼び出しでは、そのファイル記述子に処理待ち中の I/O イベントがあるかどうかを監視します。 fd は整数か、整数値を返す fileno() メソッドを持つオブジェクトを取ります。ファイルオブジェクトも fileno() を実装しているので、引数として使うことができます。
devpoll.modify(fd[, eventmask])|このメソッドは unregister() に続いて register() を行います。 同じことを明示的に行うよりも (少し) 効率的です。
devpoll.unregister(fd)|ポーリングオブジェクトによって追跡中のファイル記述子を登録解除します。 register() メソッドと同様に、 fd は整数か、整数値を返す fileno() メソッドを持つオブジェクトを取ります。
devpoll.poll([timeout])|登録されたファイル記述子に対してポーリングを行い、報告すべき I/O イベントまたはエラーの発生したファイル記述子毎に 2 要素のタプル (fd, event) からなるリストを返します。リストは空になることもあります。 fd はファイル記述子で、 event は該当するファイル記述子について報告されたイベントを表すビットマスクです — 例えば POLLIN は入力待ちを示し、 POLLOUT はファイル記述子に対する書き込みが可能を示す、などです。空のリストは呼び出しがタイムアウトしたか、報告すべきイベントがどのファイル記述子でも発生しなかったことを示します。 timeout が与えられた場合、処理を戻すまで待機する時間の長さをミリ秒単位で指定します。 timeout が省略されたり、 -1 であったり、あるいは None の場合、そのポーリングオブジェクトが監視している何らかのイベントが発生するまでブロックします。

## [18.3.2. エッジおよびレベルトリガポーリング (epoll) オブジェクト]()

http://linux.die.net/man/4/epoll

属性|概要
----|----
epoll.close()|epoll オブジェクトの制御用ファイル記述子を閉じます。
epoll.closed|epoll オブジェクトが閉じている場合 True です。
epoll.fileno()|制御用ファイル記述子の番号を返します。
epoll.fromfd(fd)|fd から epoll オブジェクトを作成します。
epoll.register(fd[, eventmask])|epoll オブジェクトにファイル記述子 fd を登録します。
epoll.modify(fd, eventmask)|登録されたファイル記述子変更します。
epoll.unregister(fd)|epoll オブジェクトから登録されたファイル記述子 fd を削除します。
epoll.poll(timeout=-1, maxevents=-1)|イベントを待機します。timeout はタイムアウト時間で、単位は秒 (float型) です。

## [18.3.3. ポーリングオブジェクト]()

> poll() システムコールはほとんどの Unix システムでサポートされており、非常に多数のクライアントに同時にサービスを提供するようなネットワークサーバが高いスケーラビリティを持てるようにしています。 poll() は対象のファイル記述子を列挙するだけでよいため、良くスケールします。一方、 select() はビット対応表を構築し、対象ファイルの記述子に対応するビットを立て、その後全ての対応表の全てのビットを線形探索します。 select() は O(最大のファイル記述子番号) なのに対し、 poll() は O(対象とするファイル記述子の数) で済みます。

属性|概要
----|----
poll.register(fd[, eventmask])|ファイル記述子をポーリングオブジェクトに登録します。これ以降の poll() メソッド呼び出しでは、そのファイル記述子に処理待ち中の I/O イベントがあるかどうかを監視します。 fd は整数か、整数値を返す fileno() メソッドを持つオブジェクトを取ります。ファイルオブジェクトも fileno() を実装しているので、引数として使うことができます。
poll.modify(fd, eventmask)|登録されているファイル記述子 fd を変更する。これは、 register(fd, eventmask) と同じ効果を持ちます。登録されていないファイル記述子に対してこのメソッドを呼び出すと、 errno ENOENT で OSError 例外が発生します。
poll.unregister(fd)|ポーリングオブジェクトによって追跡中のファイル記述子を登録解除します。 register() メソッドと同様に、 fd は整数か、整数値を返す fileno() メソッドを持つオブジェクトを取ります。
poll.poll([timeout])|登録されたファイル記述子に対してポーリングを行い、報告すべき I/O イベントまたはエラーの発生したファイル記述子毎に 2 要素のタプル (fd, event) からなるリストを返します。リストは空になることもあります。 fd はファイル記述子で、 event は該当するファイル記述子について報告されたイベントを表すビットマスクです — 例えば POLLIN は入力待ちを示し、 POLLOUT はファイル記述子に対する書き込みが可能を示す、などです。空のリストは呼び出しがタイムアウトしたか、報告すべきイベントがどのファイル記述子でも発生しなかったことを示します。 timeout が与えられた場合、処理を戻すまで待機する時間の長さをミリ秒単位で指定します。 timeout が省略されたり、負の値であったり、あるいは None の場合、そのポーリングオブジェクトが監視している何らかのイベントが発生するまでブロックします。

## [18.3.4. kqueue オブジェクト]()

属性|概要
----|----
kqueue.close()|kqueue オブジェクトの制御用ファイル記述子を閉じる。
kqueue.closed|kqueue オブジェクトが閉じている場合 True です。
kqueue.fileno()|制御用ファイル記述子の番号を返します。
kqueue.fromfd(fd)|与えられたファイル記述子から、kqueue オブジェクトを作成する。
kqueue.control(changelist, max_events[, timeout=None]) → eventlist|kevent に対する低水準のインタフェース

## [18.3.5. kevent オブジェクト]()

https://www.freebsd.org/cgi/man.cgi?query=kqueue&sektion=2

属性|概要
----|----
kevent.ident|イベントを特定するための値。この値は、フィルタにもよりますが、大抵の場合はファイル記述子です。コンストラクタでは、 ident として、整数値か fileno() メソッドを持ったオブジェクトを渡せます。 kevent は内部で整数値を保存します。
kevent.filter|カーネルフィルタの名前。
kevent.flags|フィルタアクション。
kevent.fflags|フィルタ依存のフラグ。
kevent.data|フィルタ固有のデータ。
kevent.udata|ユーザー定義値。

